@using MyTaskManagement.Models
@model IEnumerable<MyTaskManagement.Models.Project>

@{
    ViewBag.Title = "Projects";
}

<h2>Projects</h2>

<p>
    @Html.ActionLink("Create New", "Create", "Project","", new { @class = "btn btn-success" })
</p>
<table class="table" id="listProject">
    
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Id)
            </th>

            <th>
                @Html.DisplayNameFor(model => model.StartTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DeadTime)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Status)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Client.Name)
            </th>
            <th>
                <p> Users</p>
            </th>
            <th>
                <p> Tasks </p>
            </th>
            <th>
                <p>In Progress</p>
            </th>
            <th></th>
        </tr>

    </thead>
    
    <tbody>

        @foreach (var item in Model)
        {
            <tr>
             
                <td>
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.StartTime)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DeadTime)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Status)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Client.Name)
                </td>
                <th>
                    @foreach (var u in item.Users)
                    {
                        @Html.DisplayFor(modelItem => u.FirstName)
                        <br/>

                        
                    }

                </th>
                <td>
                    <p>@item.Tasks.Count</p>
                </td>
                   
                    @{
                        var numberOfTaskInProgress = item.Tasks.Where(task => task.Status == StatusEnum.InProgress).ToList().Count();


                    }
                <td>
                     <p> @numberOfTaskInProgress </p>
                </td>
                   

                <td>
                    @Html.ActionLink("Edit", "Edit", new {id = item.Id}, new {@class = "btn btn-success"}) |
                    @Html.ActionLink("Details", "Details", new {id = item.Id}, new {@class = "btn btn-info"}) |
                    @Html.ActionLink("Delete", "DeleteProject", new {id = item.Id}, new {@class = "btn btn-danger"})
                </td>
            </tr>
        }


    </tbody>
   
</table>
@section scripts
{

    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#listProject").dataTable();
        });
    </script>
}